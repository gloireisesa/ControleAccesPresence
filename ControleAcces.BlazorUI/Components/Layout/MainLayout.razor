@inherits LayoutComponentBase
@using ControleAcces.Shared.DTOs
@inject NavigationManager Navigation

<div class="d-flex min-vh-100">

    @* Sidebar uniquement si utilisateur connecté *@
    @if (SessionUtilisateur.Current != null)
    {
        <nav class="sidebar p-3 d-flex flex-column shadow">
            <a href="/" class="d-flex align-items-center mb-4 text-decoration-none fs-4 fw-bold text-white">
                <i class="bi bi-shield-lock-fill me-2"></i> ControleAcces
            </a>

            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item mb-2">
                    <NavLink href="/" class="nav-link d-flex align-items-center" activeClass="active" exact="true">
                        <i class="bi bi-house-door-fill"></i>
                        <span>Accueil</span>
                    </NavLink>
                </li>

                @if (SessionUtilisateur.Current.Role == "Admin")
                {
                    <li class="nav-item mb-2">
                        <NavLink href="sessions" class="nav-link d-flex align-items-center" activeClass="active">
                            <i class="bi bi-calendar-plus-fill"></i>
                            <span>Créer Sessions</span>
                        </NavLink>
                    </li>
                    <li class="nav-item mb-2">
                        <NavLink href="enrol-etudiant" class="nav-link d-flex align-items-center" activeClass="active">
                            <i class="bi bi-person-plus-fill"></i>
                            <span>Enrôler Étudiant</span>
                        </NavLink>
                    </li>
                    <li class="nav-item mb-2">
                        <NavLink href="gestion-modules" class="nav-link d-flex align-items-center" activeClass="active">
                            <i class="bi bi-journal-bookmark-fill"></i>
                            <span>Gestion Module</span>
                        </NavLink>
                    </li>
                }

                <li class="nav-item mb-2">
                    <NavLink href="gestion-salles" class="nav-link d-flex align-items-center" activeClass="active">
                        <i class="bi bi-building-fill"></i>
                        <span>Gestion Salle</span>
                    </NavLink>
                </li>

                <li class="nav-item mb-2">
                    <NavLink href="rapport-presence" class="nav-link d-flex align-items-center" activeClass="active">
                        <i class="bi bi-file-earmark-text-fill"></i>
                        <span>Rapport</span>
                    </NavLink>
                </li>
            </ul>

            <hr class="mt-auto text-white-50" />
            <div class="small text-center text-white-50 mt-2">
                © 2025 ControleAcces
            </div>
        </nav>
    }

    @* Main Content *@
    <main class="flex-grow-1 p-4 content-area">
        @Body
    </main>

</div>

<style>
    /* Sidebar couleurs */
    .sidebar {
        width: 260px;
        min-height: 100vh;
        background: linear-gradient(180deg, #0b3d91, #0d6efd);
        color: white;
        border-right: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }

    /* Liens */
    .nav-link {
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
        padding: 0.6rem 0.9rem;
        border-radius: 0.375rem;
        gap: 10px;
        transition: all 0.3s ease;
    }

        .nav-link i {
            font-size: 1.2rem;
        }

        .nav-link span {
            flex-grow: 1;
        }

        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.15);
            color: #ffffff;
            transform: translateX(3px);
        }

        .nav-link.active {
            background-color: white !important;
            color: #0b3d91 !important;
            font-weight: 600;
            box-shadow: 0 0 10px rgba(13, 110, 253, 0.5);
        }

    /* Main Content */
    .content-area {
        background-color: #f0f4f8; /* gris doux pour tout le contenu */
        min-height: 100vh;
        transition: all 0.3s ease;
    }
</style>

@code {
    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            // Redirection vers login si utilisateur non connecté
            if (SessionUtilisateur.Current == null && !Navigation.Uri.Contains("login"))
            {
                Navigation.NavigateTo("/login", forceLoad: true);
            }
        }
    }
}
